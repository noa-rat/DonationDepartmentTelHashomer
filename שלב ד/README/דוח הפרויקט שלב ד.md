# DonationDepartmentTelHshomer
## תוכן עניינים
1. [תוכנית ראשית 1](#תוכנית_ראשית_1)
2. [תוכנית ראשית 2](#תוכנית_ראשית_2)

## תוכנית ראשית 1
**תיאור מילולי:** התוכנית מוסיפה מטופל חדש, ובכך מפעילה 2 טריגרים שמפעילים 2 פונקציות למציאת רופא מטפל וחדר לשהות בו. לאחר מכן התוכנית מפעילה פונקציה שמחזירה טבלה עם מידע אודות כל חדר והאם מוקצית לו אחות אחראית, היא מדפיסה את נתוני הטבלה ואז מפעילה עליה פרוצדורה שמקצה אחיות לכל החדרים שאין להם אחות אחראית, ובנוסף בודקת האם יש חדר עם תפוסה הגבוהה מהקיבולת המקסימלית. אם כן, היא מנסה להעביר את המטופלים העודפים לחדרים פנויים.

**הקוד:**DO $$
DECLARE
    dept RECORD;
    count_departments INT := 0;
BEGIN
    RAISE NOTICE 'Starting donation check and event creation...';

    FOR dept IN SELECT * FROM get_departments_below_budget() LOOP
        count_departments := count_departments + 1;
        RAISE NOTICE 'Handling department: %', dept.department_name;
        CALL create_fundraisingEvent_for_department(dept.department_name);
        COMMIT;
    END LOOP;

    IF count_departments = 0 THEN
        RAISE NOTICE 'All departments have reached their fundraising goals.';
    ELSE
        RAISE NOTICE 'Processed % departments with unmet fundraising goals.', count_departments;
    END IF;
END $$;


**צילום מסך לפני הרצת התוכנית:**

![before_changes2](https://raw.githubusercontent.com/noa-rat/DonationDepartmentTelHashomer/main/שלב%20ד/before_changes2.png)

**צילום מסך של הרצת התוכנית:**

![run_main_program2](https://raw.githubusercontent.com/noa-rat/DonationDepartmentTelHashomer/main/שלב%20ד/run_main_program2.png)


**צילום מסך אחרי הרצת התוכנית:**

![after_changes2](https://raw.githubusercontent.com/noa-rat/DonationDepartmentTelHashomer/main/שלב%20ד/after_changes2.png)

## תוכנית ראשית 2
**תיאור מילולי:** התוכנית מפעילה פונקציה שמחזירה את כל המחלקות שעוד לא גייסו מספיק תרומות כדי לעמוד ביעד התקציב שלהן, ואז מפעילה פרוצדורה בלולאה על כל אחת מהמחלקות שמוסיפה אירוע חדש לגיוס תרומות לאותה מחלקה ומתאמת מגייס תרומות פנוי שיארגן את האירוע.

**הקוד**
DO $$
DECLARE
    dept RECORD;
    count_departments INT := 0;
BEGIN
    RAISE NOTICE 'Starting donation check and event creation...';

    FOR dept IN SELECT * FROM get_departments_below_budget() LOOP
        count_departments := count_departments + 1;
        RAISE NOTICE 'Handling department: %', dept.department_name;
        CALL create_fundraisingEvent_for_department(dept.department_name);
        COMMIT;
    END LOOP;

    IF count_departments = 0 THEN
        RAISE NOTICE 'All departments have reached their fundraising goals.';
    ELSE
        RAISE NOTICE 'Processed % departments with unmet fundraising goals.', count_departments;
    END IF;
END $$;


**צילום מסך לפני הרצת התוכנית:**

![before_changes1](https://raw.githubusercontent.com/noa-rat/DonationDepartmentTelHashomer/main/שלב%20ד/before_changes1.png)

**צילום מסך של הרצת התוכנית:**

![run_main_program1](https://raw.githubusercontent.com/noa-rat/DonationDepartmentTelHashomer/main/שלב%20ד/run_main_program1.png)


**צילום מסך אחרי הרצת התוכנית:**

![after_changes1](https://raw.githubusercontent.com/noa-rat/DonationDepartmentTelHashomer/main/שלב%20ד/after_changes1.png)

